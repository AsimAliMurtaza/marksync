generator client {
  provider        = "prisma-client-js"
  engineType      = "library"
}


datasource db {
  provider = "postgresql"
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model attendance {
  id          BigInt      @id @default(autoincrement())
  student_id  BigInt
  course_id   BigInt
  timestamp   DateTime?   @default(now()) @db.Timestamp(6)
  status      String      @db.VarChar(20)
  latitude    Decimal?    @db.Decimal(10, 7)
  longitude   Decimal?    @db.Decimal(10, 7)
  courses     courses     @relation(fields: [course_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users       users       @relation(fields: [student_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  enrollments enrollments @relation(fields: [student_id, course_id], references: [student_id, course_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_enrollment")
}

model courses {
  id             BigInt        @id @default(autoincrement())
  semester_id    BigInt
  title          String        @db.VarChar(200)
  code           String        @db.VarChar(50)
  day_of_week    String        @db.VarChar(20)
  start_time     DateTime      @db.Time(6)
  end_time       DateTime      @db.Time(6)
  room           String        @db.VarChar(50)
  latitude       Decimal       @db.Decimal(10, 7)
  longitude      Decimal       @db.Decimal(10, 7)
  allowed_radius Int           @default(30)
  created_by     BigInt
  created_at     DateTime?     @default(now()) @db.Timestamp(6)
  attendance     attendance[]
  users          users         @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  semesters      semesters     @relation(fields: [semester_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  enrollments    enrollments[]
}

model devices {
  id          BigInt    @id @default(autoincrement())
  user_id     BigInt
  device_hash String
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  users       users     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([user_id, device_hash])
}

model enrollments {
  id          BigInt       @id @default(autoincrement())
  student_id  BigInt
  course_id   BigInt
  enrolled_at DateTime?    @default(now()) @db.Timestamp(6)
  attendance  attendance[]
  courses     courses      @relation(fields: [course_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users       users        @relation(fields: [student_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([student_id, course_id])
}

model semesters {
  id         BigInt    @id @default(autoincrement())
  name       String    @db.VarChar(100)
  start_date DateTime  @db.Date
  end_date   DateTime  @db.Date
  created_by BigInt
  created_at DateTime? @default(now()) @db.Timestamp(6)
  courses    courses[]
  users      users     @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model users {
  id            BigInt        @id @default(autoincrement())
  name          String        @db.VarChar(100)
  email         String        @unique @db.VarChar(150)
  password_hash String
  role          String        @db.VarChar(20)
  created_at    DateTime?     @default(now()) @db.Timestamp(6)
  attendance    attendance[]
  courses       courses[]
  devices       devices[]
  enrollments   enrollments[]
  semesters     semesters[]
}
